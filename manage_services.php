<?php session_start(); require_once __DIR__.'/../includes/config.php'; if (empty($_SESSION['admin_logged_in'])) { header('Location: login.php'); exit; } try { $pdo = new PDO("mysql:host={$db_host};dbname={$db_name};charset=utf8mb4", $db_user, $db_pass, [PDO::ATTR_ERRMODE=>PDO::ERRMODE_EXCEPTION]); } catch (Exception $e) { $pdo=null; } if ($_SERVER['REQUEST_METHOD']==='POST') { $title = $_POST['title'] ?? ''; $desc = $_POST['description'] ?? ''; $img = ''; if (!empty($_FILES['image']['name'])) { $name = preg_replace('/[^a-zA-Z0-9._-]/','_',basename($_FILES['image']['name'])); $target = __DIR__.'/../uploads/images/'.$name; move_uploaded_file($_FILES['image']['tmp_name'], $target); $img = $name; } if ($pdo) { $stmt = $pdo->prepare('INSERT INTO services (title, description, image, created_at) VALUES (?, ?, ?, NOW())'); $stmt->execute([$title, $desc, $img]); } header('Location: manage_services.php'); exit; } if (isset($_GET['delete']) && $pdo) { $id=(int)$_GET['delete']; $stmt=$pdo->prepare('SELECT image FROM services WHERE id=?'); $stmt->execute([$id]); $r=$stmt->fetch(PDO::FETCH_ASSOC); if($r && $r['image']){@unlink(__DIR__.'/../uploads/images/'.$r['image']);} $stmt=$pdo->prepare('DELETE FROM services WHERE id=?'); $stmt->execute([$id]); header('Location: manage_services.php'); exit; } $services = $pdo ? $pdo->query('SELECT * FROM services ORDER BY id DESC')->fetchAll(PDO::FETCH_ASSOC) : []; ?><!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>Manage Services</title><link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel='stylesheet'></head><body><div class='container py-4'><h3>Manage Services</h3><form method='post' enctype='multipart/form-data'><div class='mb-3'><label>Title</label><input name='title' class='form-control' required></div><div class='mb-3'><label>Description</label><textarea name='description' class='form-control' rows='3' required></textarea></div><div class='mb-3'><label>Image</label><input type='file' name='image' class='form-control'></div><button class='btn btn-primary' type='submit'>Add Service</button></form><hr><div class='row'><?php foreach($services as $s): ?><div class='col-md-4 mb-3'><div class='card'><img src='../uploads/images/<?php echo htmlspecialchars($s['image']); ?>' class='img-fluid'><div class='p-2 text-center'><strong><?php echo htmlspecialchars($s['title']); ?></strong><p><?php echo htmlspecialchars($s['description']); ?></p><a class='btn btn-sm btn-danger' href='manage_services.php?delete=<?php echo $s['id']; ?>'>Delete</a></div></div></div><?php endforeach; ?></div><a href='dashboard.php' class='btn btn-secondary'>Back</a></div></body></html>